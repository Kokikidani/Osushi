<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ãƒãƒƒãƒ—</title>
    

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <style>
        .fixed-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #fff;
            color: #9acd32;
            text-align: left;
            padding: 10px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 1000;
            font-family: 'ãƒ’ãƒ©ã‚®ãƒä¸¸ã‚´ ProN', 'Hiragino Maru Gothic Pro', 'ãƒ¡ã‚¤ãƒªã‚ª', Meiryo, sans-serif;
            font-size: 2em;
            font-weight: bold;
        }
        body {
            padding-top: 50px;
        }
    </style>
</head>
<body>
    <div class="fixed-header">æ±å±±å‹•æ¤ç‰©åœ’NaviğŸ¦ŠğŸ¯ğŸ¼ğŸ¹ğŸ¦ğŸ°ğŸ¶</div>
    
    <p id="current-location">ç¾åœ¨åœ°: æœªå–å¾—</p>

    <div id="map" style="width: 600px; height: 400px; margin-top: 30px;"></div>
    <button onclick="requestLocationPermission()">ä½ç½®æƒ…å ±ã®è¨±å¯ã‚’æ±‚ã‚ã‚‹</button>

    <script>
        function initMap() {
            var map = L.map('map').setView([35.1575, 136.9738], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
                maxZoom: 18,
            }).addTo(map);
            return map;
        }

        function requestLocationPermission() {
    if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(function(position) {
            // ç·¯åº¦ã¨çµŒåº¦ã‚’å–å¾—
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;

            // ç·¯åº¦çµŒåº¦ã‚’è¡¨ç¤º
            document.getElementById('current-location').textContent = 'ç¾åœ¨åœ°: ç·¯åº¦ ' + latitude + ', çµŒåº¦ ' + longitude;

            // ã‚µãƒ¼ãƒãƒ¼ã«ä½ç½®æƒ…å ±ã‚’é€ä¿¡
            fetch("/update_location", {
                method: "POST",
                body: JSON.stringify({ latitude, longitude }),
                headers: {
                    "Content-Type": "application/json"
                }
            })
            .then(response => response.json())
            .then(route => {
                console.log("Received route:", route);  // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚ã®ãƒ­ã‚°
                displayRoute(route);
            });
        }, function(error) {
            alert("ä½ç½®æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: " + error.message);
        });
    } else {
        alert("Geolocation is not supported by your browser.");
    }
}


    

    var map = initMap();

        function displayRoute(route) {console.log(route);  // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚ã®ãƒ­ã‚°å‡ºåŠ›
    var routeLine = L.polyline(route, {color: 'blue'}).addTo(map);
    map.fitBounds(routeLine.getBounds());
          
        }
    </script>

    <p>è©³ç´°æƒ…å ±ã¯<a href="https://www.higashiyama.city.nagoya.jp/">æ±å±±å‹•ç‰©åœ’ã®å…¬å¼ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ</a>ã‚’ã”è¦§ãã ã•ã„ã€‚</p>
</body>
</html>
